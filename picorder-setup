#!/bin/bash
# Clear the screen
clear
TERM=ansi
# Theme setting dark comment to enable system colors
theme="dark:0"

if [ $theme = "dark:0" ]; then
  export NEWT_COLORS='
    root=white,black
    window=white,black
    textbox=white,black
    title=white,black
    listbox=white,black
    sellistbox=black,yellow
    actsellistbox=black,yellow
    border=black,blue
    actbutton=black,green
    button=white,black
    '
fi
# Language strings
message="  Welcome to picorderOS  "
title=" piCorder installer "
verInfo="thisver " #TODO
txtMenu01="Install      This will install and configure picorderOS"
txtMenu02="Configure    TODO:"
txtAbout="About        About this tool"
txtHelloWorld=" Hello World: "
txtWelcome="Welcome to piCorder-config: "
txtExit="Exit "
txtJobsDone="piCorderOS Installed. To launch type piCorderOS  "
txtContinueY=" Continue "
txtContinueN=" Back "
txtPlzWait="Please Wait.."
txtRequierments=" Press Continue to Download and install picorderOS?  " #PTODO list About subpage!?
aboutConfig=" This tool aims to easly initial configuration piCorderOs. $verInfo "

function setup108 {
if (whiptail --fb --title "$message" --yesno "$txtRequierments" 20 60 --no-button "$txtExit" --yes-button "$txtContinueY"); then

    sudo apt update &> log | whiptail --gauge "Please wait Updating repository" 10 60 5 #todo:Gauge %
    sudo apt install -y git python3-pip python3-smbus &> log | whiptail --gauge "$txtPleaseWait  installing system Requierments" 10 60 25
    sudo apt install -y libatlas-base-dev libopenjp2-7-dev libsdl2-dev libtiff5 libsdl-ttf2.0-dev &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPlease  installing SDL Base" 10 60 35
    sudo apt install -y libsdl-gfx1.2-5 libsdl-image1.2 libsdl-kitchensink1 libsdl-mixer1.2 libsdl-sound1.2 &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWait  installing SDL GFX " 10 60 50
    sudo apt install -y libsdl-ttf2.0-0 libsdl1.2debian libsdl2-2.0-0 libsdl2-gfx-1.0-0 libsdl2-image-2.0-0 libsdl2-mixer-2.0-0 libsdl2-ttf-2.0-0 &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing SDL GFX continue " 10 60 75
    echo "Enableing i2c spi" &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile Enableing i2c and spi" 10 60 76    
    sudo sed -i -e 's/#dtparam=i2c_arm=on/dtparam=i2c_arm=on/g' /boot/config.txt && sudo sed -i -e 's/#dtparam=spi=on/dtparam=spi=on/g' /boot/config.txt

    if (ls $HOME/.local/include/piCorderOS/);then
      echo "piCorderOS exist" &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWait  " 10 60 90
    else
      cd $HOME/.local/include/ && git clone https://github.com/Tearran/picorder-config.git &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing picorder-config" 20 60 80
      cd $HOME/.local/include/ && git clone https://github.com/tearran/picorderOS.git &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing picorderOS" 20 60 85
      cd $HOME/.local/include/picorderOS/ && python3 -m pip install -r requirements.txt &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing python requirements" 20 60 90
    fi
    
    echo "python3 $HOME/.local/include/picorderOS/main.py" > $HOME/.local/bin/piCorderOS &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing picorderOS system launcher" 20 60 91
    chmod 755 $HOME/.local/bin/piCorderOS &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing" 20 60 92
    cp "$HOME/.local/include/picorder-config/picorder-config" > $HOME/.local/bin/picorder-config &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWait installing picorder-config system launcher" 20 60 95
    chmod 755 $HOME/.local/include/picorder-config/picorder-config &> $HOME/.local/include/picorder-config/log | whiptail --gauge "$txtPleaseWaitwhile installing" 20 60 100
fi
}

setup108
